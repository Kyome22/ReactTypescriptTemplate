<!-- title:Macアプリ配布用の.dmgの作成方法（2019 Mojave版） -->
自作アプリがどうもAppStore経由では配信できなさそうなので，よくある`.dmg`形式で配布しようと思いやり方を探したら，[カスタマイズした.dmgを作成する方法](https://qiita.com/econa77/items/d0e7d3a75d8fd3bb7777)という記事を見つけました．しかし，どうやら現在はほんの少しやり方が変わっていたようので，改めてここに書き残します．

# 環境
macOS Mojave: 10.14.5

# 素材の準備
## 配布用アプリ
アプリが完成したら，Developer IDとしてアプリをエクスポートしてください．
<img width="1000" alt="へ.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/67153/087be305-fa3c-775b-11b9-c78e8fada457.png">
<img width="1000" alt="ほ.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/67153/4752789b-b5fe-2d1b-cb9f-cbdfaf1558cd.png">
あとは流れでよいしょ．
`〜.app`が生成されればOK

## 背景画像
dmgの背景に使用する画像を作成してください．
<img width="823" alt="スクリーンショット 2019-07-09 18.31.12.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/67153/de8d7347-f3d8-9e7a-a5b2-0c3a44469b22.png">

retinaに対応するために，1倍のものと2倍のもの（1200px × 750pxくらい？）を用意します．そうしたら，Terminalを使って以下のコマンドで背景用画像の`.tiff`ファイルを生成します．

```plaintext
$ tiffutil -cathidpicheck １倍の背景画像 2倍の背景画像 -out backImage.tiff
```

## Applicationsフォルダのエイリアス
`Macintosh HD`の中の`アプリケーション`フォルダのエイリアスを作ります．

#dmgの作成
ディスクユーティリティを開いてメニューバーのファイル>新規イメージ>空のイメージを作成を押します．
<img width="805" alt="ふ.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/67153/dda1065d-3687-c255-9123-83d8d7ea4335.png">
 
編集する項目は名前だけです．アプリの配布が目的なので，「アプリ名_バージョン」とすると良いと思います．
<img width="925" alt="ha.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/67153/e42f6e84-8b8b-e925-f69a-7f022f6a6798.png">

そうすると，デスクトップに`．dmg`と`ボリューム`が生成表示されますのでボリュームを開いて，ボリュームの中に配布用アプリとアプリケーションフォルダのエイリアスをコピーします．続いてterminalを用いてボリュームの中に`.resource`という名前の隠しフォルダを作り，中に背景用画像を入れます．

ここまでできたらあともう少し，ボリュームのウィンドウを選択した状態で表示オプションを表示し，アイコンのサイズと背景画像を設定します．(背景画像は`.resource`フォルダの中のものをドラッグ&ドロップ)最後にアイコンの位置とウィンドウサイズを微調整したら，ボリュームのマウントを外せば`.dmg`の完成です．確認のために出来上がった`.dmg`を一度展開してボリュームを開いて見た目を確認しましょう．(`.dmg`を直接編集していないので不思議な気持ちになるかもしれませんが，これでOKなのです．)
<img width="899" alt="スクリーンショット 2019-07-09 18.50.45.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/67153/0e2a9582-1a86-3799-7f87-45b0abf84b31.png">

# 所感
背景画像を用意するのは面倒ですが，案外簡単に作ることができますね．

# 参考
[カスタマイズした.dmgを作成する方法](https://qiita.com/econa77/items/d0e7d3a75d8fd3bb7777)
[Xcode : Mac用アプリをMac App Storeを使用せずに個人配布する|配布用.dmgファイルの作成](https://hikaruapp.jpn.com/xcode/osx/post-645)
